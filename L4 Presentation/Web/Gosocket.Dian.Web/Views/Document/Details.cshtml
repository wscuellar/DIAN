@model Gosocket.Dian.Web.Models.DocValidatorModel

@{
    ViewBag.Title = "Detalles del documento";
}

@section css
{
    <!--Bootstrap Select [ OPTIONAL ]-->
    <link href="~/Content/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet">
    <link href="~/Content/plugins/chosen/chosen.min.css" rel="stylesheet">

    <style>
        .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn) {
            width: 135px !important;
        }

        .tab-base .tab-content {
            margin-left: 20px;
            margin-right: 20px;
            padding-bottom: 20px;
        } 

        .tab-base .tab-content {
            margin-top: 50px;
        }

        .title-container {
            margin-left: 20px;
            margin-top: 19px;
        }

        .modal-lg {
            width: auto !important;
        }
    </style>
}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<div class="page-content margin-15">
    <div id="divPageContent" class="row margin-horizontal-0">

        <div class="tab-base">
            <!-- Navs Tabs -->

            @{
                if (Model.Document.References.Count() > 0 || Model.Document.DocumentTags.Count() > 0)
                {
                    <ul class="nav nav-tabs">
                        <li class="active"><a>@Model.Document.DocumentTypeName</a></li>
                        @foreach (var item in Model.Document.References)
                        {
                            <li><a href="@Url.Action("Details", "Document", new { trackId = item.DocumentKey })">@item.DocumenTypeName</a></li>
                        }
                        @foreach (var t in Model.Document.DocumentTags)
                        {
                            <li><a href="@Url.Action("Details", "Document", new { trackId = t.Value })">@t.Description</a></li>
                        }
                    </ul>
                }
                else
                {
                    <div class="title-container">
                        <p class="title-view">
                            @Model.Document.DocumentTypeName
                        </p>
                        <div class="underline-title"></div>
                    </div>
                }
            }

            <!--Navs Content -->
            <div class="tab-content">
                <div id="divViewerPartial" class="panel-body padding-top-20">
                    @Html.Partial("_ViewerPartial")
                </div>
            </div>
        </div>

    </div>
</div>
<div class="tab-content">
    <div id="modifyWrapper">

    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <!--Bootstrap Select [ OPTIONAL ]-->
    <script src="~/Content/plugins/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="~/Content/js/bootstrap-filestyle.min.js"></script>
    <script src="~/Content/js/file-validator.js"></script>
    <script src="~/Content/js/Radian/RadianPrintDocumentPdf.js"></script>
    <script src="~/Content/js/Radian/RadianIndex.js"></script>


    <script>

        function showModal(cude) {
            debugger;
            showPdfModal("#show-graphic-document",cude,'@Url.Action("PrintGraphicRepresentation", "Document")');
        }

        $(document).ready(function () {
            showPdfModal("#show-document", "@Model.Document.DocumentKey", '@Url.Action("PrintDocument", "Document")');
            $('#container1-title').hide();
            $('.document-row').click('onClick', function () {
                if (!$(this).hasClass('not-redirect')) {
                        var id = $(this).context.getAttribute('data-id');
                        var partitionKey = $(this).context.getAttribute('data-partitionKey');
                        window.location.href = "/Document/Details?trackId=" + id + "&partitionKey=" + partitionKey;
                }
                else
                    $(this).removeClass('not-redirect')
            });

            $(".eventView").click(function () {
                var documentKey = $(this).parent().find("#DocumentKey").val()
                $('#container1').fadeOut(200);
                GetEventsPartialView(documentKey);

                setTimeout(function () {
                    $('#divViewerPartial').css("height", "635px");
                    $('#divPageContent').css('max-height', '623px');
                }, 200)
            })

            $('#divViewMoreQueryList').hide();
        });

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        function GetEventsPartialView(id) {
            var url = '/QueryAssociatedEvents/EventsView?id=' + id + "&cufe=" + '@Model.Document.DocumentKey'
            $.ajax({
                url: '/QueryAssociatedEvents/EventsView?id=' + id + "&cufe=" + '@Model.Document.DocumentKey',
                success: function (data, status, xhr) {
                    var injectingPartialView = xhr.getResponseHeader('InjectingPartialView');
                    if (injectingPartialView == "true") {
                        $('#modifyWrapper').html(data);
                        $('#modifyWrapper').fadeIn(300);
                        $('#container1-title').fadeIn(300);
                        $('#divChildrenModifyWrapper').css("padding-top", "100px");
                    }
                    else {
                        window.location.href = '/User/Login';
                    }
                }
            });

        };

        function changeTab(id) {
            window.location.href = "/Document/Details?trackId=" + id;
        }

        function darClick() {
            $('#modifyWrapper').fadeOut(300);
            $('#container1-title').fadeOut(300);
            $('#divViewerPartial').css('height', '');
            $('#divPageContent').css('max-height', '');
            $('#divChildrenModifyWrapper').css('padding-top', '');
            setTimeout(function () {
                $('#container1').fadeIn(300);
            }, 500);
        }

        function showMore() {
            $('#modifyWrapper').fadeOut(300);
            $('#container1-title').fadeOut(300);
            $('#divViewerPartial').css('height', '');
            $('#divPageContent').css('max-height', '');
            $('#divChildrenModifyWrapper').css('padding-top', '');
            setTimeout(function () {
                $('#container1').fadeIn(300);
            }, 500);
        }

    </script>

}
